-- Auto Mine | Velocity Executor Compatible
-- Features: Webhook, Draggable GUI, Center Position

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local mouse = player:GetMouse()

local MineEvent = ReplicatedStorage:WaitForChild("MineEvent")

-- WEBHOOK CONFIGURATION
local WEBHOOK_URL = "https://discord.com/api/webhooks/1464754456523706629/U2tO9FBgF827mZYjkdxPEx_NXIgi3AtdLdF40TKJ63xUB8QU568Tet5yK5o8I6EV46cV"
local SEND_WEBHOOK = true -- Set false untuk disable webhook

-- State
local character, humanoid, rootPart
local currentTool = nil
local isEquipped = false
local isMining = false
local mineCount = 0
local autoMineEnabled = false
local m1Track, minedTrack, dapetTrack = nil, nil, nil

-- Stats
local totalMined = 0
local sessionStartTime = tick()

--------------------------------------------------
-- WEBHOOK FUNCTION
--------------------------------------------------
local function sendWebhook(message, color)
	if not SEND_WEBHOOK or WEBHOOK_URL == "https://discord.com/api/webhooks/YOUR_WEBHOOK_URL_HERE" then
		return
	end
	
	local success, err = pcall(function()
		local data = {
			["embeds"] = {{
				["title"] = "‚õèÔ∏è Auto Mine Notification",
				["description"] = message,
				["color"] = color or 3447003,
				["fields"] = {
					{
						["name"] = "Player",
						["value"] = player.Name,
						["inline"] = true
					},
					{
						["name"] = "Total Mined",
						["value"] = tostring(totalMined),
						["inline"] = true
					},
					{
						["name"] = "Session Time",
						["value"] = string.format("%.1f min", (tick() - sessionStartTime) / 60),
						["inline"] = true
					}
				},
				["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S")
			}}
		}
		
		local jsonData = HttpService:JSONEncode(data)
		request({
			Url = WEBHOOK_URL,
			Method = "POST",
			Headers = {
				["Content-Type"] = "application/json"
			},
			Body = jsonData
		})
	end)
	
	if not success then
		warn("Webhook error:", err)
	end
end

--------------------------------------------------
-- FIND TOOL (dynamically detect equipped tool)
--------------------------------------------------
local function findEquippedTool()
	if not character then return nil end
	for _, child in pairs(character:GetChildren()) do
		if child:IsA("Tool") then
			return child
		end
	end
	return nil
end

--------------------------------------------------
-- LOAD ANIMATIONS FROM TOOL
--------------------------------------------------
local function loadAnimations(tool)
	m1Track, minedTrack, dapetTrack = nil, nil, nil
	if not (tool and humanoid) then return end

	local animFolder = tool:FindFirstChild("Animations")
	if not animFolder then return end

	local m1Anim = animFolder:FindFirstChild("M1")
	local minedAnim = animFolder:FindFirstChild("Mined")
	local dapetAnim = animFolder:FindFirstChild("Dapet")

	if m1Anim then m1Track = humanoid:LoadAnimation(m1Anim) end
	if minedAnim then minedTrack = humanoid:LoadAnimation(minedAnim) end
	if dapetAnim then dapetTrack = humanoid:LoadAnimation(dapetAnim) end
end

--------------------------------------------------
-- GUI SETUP
--------------------------------------------------
-- Hapus GUI lama kalau ada (re-run script)
if playerGui:FindFirstChild("AutoMineGui") then
	playerGui:FindFirstChild("AutoMineGui"):Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoMineGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Main Frame (POSISI TENGAH)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 220, 0, 140)
mainFrame.Position = UDim2.new(0.5, -110, 0.5, -70) -- Tengah layar
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = screenGui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 10)
uiCorner.Parent = mainFrame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(60, 60, 70)
stroke.Thickness = 1
stroke.Parent = mainFrame

-- Title (DRAG HANDLE)
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "TitleLabel"
titleLabel.Size = UDim2.new(1, 0, 0, 32)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
titleLabel.BorderSizePixel = 0
titleLabel.Text = "‚õè  AUTO MINE"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 14
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 10)
titleCorner.Parent = titleLabel

local titlePadding = Instance.new("UIPadding")
titlePadding.PaddingLeft = UDim.new(0, 10)
titlePadding.Parent = titleLabel

-- Stats Label
local statsLabel = Instance.new("TextLabel")
statsLabel.Size = UDim2.new(1, -20, 0, 20)
statsLabel.Position = UDim2.new(0, 10, 0, 40)
statsLabel.BackgroundTransparency = 1
statsLabel.Text = "Mined: 0"
statsLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
statsLabel.TextSize = 12
statsLabel.Font = Enum.Font.GothamBold
statsLabel.TextXAlignment = Enum.TextXAlignment.Left
statsLabel.Parent = mainFrame

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 180, 0, 35)
toggleButton.Position = UDim2.new(0.5, 0, 0, 68)
toggleButton.AnchorPoint = Vector2.new(0.5, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 90)
toggleButton.BorderSizePixel = 0
toggleButton.Text = "START"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextSize = 14
toggleButton.Font = Enum.Font.GothamBold
toggleButton.Parent = mainFrame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = toggleButton

-- Status
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 18)
statusLabel.Position = UDim2.new(0, 10, 1, -22)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: Idle"
statusLabel.TextColor3 = Color3.fromRGB(140, 140, 150)
statusLabel.TextSize = 11
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = mainFrame

--------------------------------------------------
-- DRAGGABLE GUI
--------------------------------------------------
local dragging = false
local dragInput, mousePos, framePos

titleLabel.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		mousePos = input.Position
		framePos = mainFrame.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

titleLabel.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

RunService.Heartbeat:Connect(function()
	if dragging and dragInput then
		local delta = dragInput.Position - mousePos
		mainFrame.Position = UDim2.new(
			framePos.X.Scale,
			framePos.X.Offset + delta.X,
			framePos.Y.Scale,
			framePos.Y.Offset + delta.Y
		)
	end
end)

--------------------------------------------------
-- GUI LOGIC
--------------------------------------------------
local COLOR_ON = Color3.fromRGB(50, 180, 100)
local COLOR_OFF = Color3.fromRGB(80, 80, 90)
local COLOR_STATUS_ON = Color3.fromRGB(80, 220, 120)
local COLOR_STATUS_OFF = Color3.fromRGB(140, 140, 150)
local COLOR_STATUS_WARN = Color3.fromRGB(180, 140, 60)

local function updateGui()
	if autoMineEnabled then
		toggleButton.Text = "STOP"
		toggleButton.BackgroundColor3 = COLOR_ON
		statusLabel.Text = "Status: Mining..."
		statusLabel.TextColor3 = COLOR_STATUS_ON
	else
		toggleButton.Text = "START"
		toggleButton.BackgroundColor3 = COLOR_OFF
		statusLabel.Text = "Status: Idle"
		statusLabel.TextColor3 = COLOR_STATUS_OFF
	end
	
	statsLabel.Text = string.format("Mined: %d | Time: %.1fm", totalMined, (tick() - sessionStartTime) / 60)
end

toggleButton.MouseEnter:Connect(function()
	TweenService:Create(toggleButton, TweenInfo.new(0.15), {
		BackgroundColor3 = autoMineEnabled and Color3.fromRGB(40, 160, 80) or Color3.fromRGB(100, 100, 115)
	}):Play()
end)

toggleButton.MouseLeave:Connect(function()
	updateGui()
end)

toggleButton.Activated:Connect(function()
	autoMineEnabled = not autoMineEnabled
	mineCount = 0
	
	if autoMineEnabled then
		sendWebhook("‚úÖ Auto Mine **STARTED**", 3066993) -- Green
	else
		sendWebhook("‚è∏Ô∏è Auto Mine **STOPPED**", 15158332) -- Red
	end
	
	updateGui()
end)

--------------------------------------------------
-- CHARACTER SETUP
--------------------------------------------------
local function setupCharacter(char)
	character = char
	humanoid = char:WaitForChild("Humanoid", 5)
	rootPart = char:WaitForChild("HumanoidRootPart", 5)
	currentTool = nil
	m1Track, minedTrack, dapetTrack = nil, nil, nil
	isEquipped = false
	mainFrame.Visible = false
	autoMineEnabled = false
	mineCount = 0
	sessionStartTime = tick()
	updateGui()
end

if not (player.Character and player.Character:FindFirstChild("Humanoid")) then
	player.CharacterAdded:Wait()
end
setupCharacter(player.Character)
player.CharacterAdded:Connect(setupCharacter)

--------------------------------------------------
-- DETECT TOOL EQUIPPED / UNEQUIPPED
--------------------------------------------------
local function onChildAdded(child)
	if child:IsA("Tool") then
		currentTool = child
		isEquipped = true
		mineCount = 0
		mainFrame.Visible = true
		loadAnimations(child)
		updateGui()
		sendWebhook(string.format("üîß Tool **%s** equipped", child.Name), 3447003) -- Blue
	end
end

local function onChildRemoved(child)
	if child == currentTool then
		currentTool = nil
		isEquipped = false
		autoMineEnabled = false
		mineCount = 0
		m1Track, minedTrack, dapetTrack = nil, nil, nil
		mainFrame.Visible = false
		updateGui()
	end
end

local function connectCharacterEvents()
	if not character then return end
	character.ChildAdded:Connect(onChildAdded)
	character.ChildRemoved:Connect(onChildRemoved)

	-- Cek kalau tool sudah di-equip saat script run
	local tool = findEquippedTool()
	if tool then
		onChildAdded(tool)
	end
end

connectCharacterEvents()
player.CharacterAdded:Connect(function(char)
	task.wait(0.5)
	connectCharacterEvents()
end)

--------------------------------------------------
-- FIND NEAREST BLOCK
--------------------------------------------------
local function findNearestBlock()
	if not rootPart then return nil end
	local nearest = nil
	local nearestDist = math.huge

	for _, obj in pairs(workspace:GetDescendants()) do
		if obj.Name == "Block" and obj:IsA("BasePart") then
			local dist = (rootPart.Position - obj.Position).Magnitude
			if dist <= 10 and dist < nearestDist then
				nearest = obj
				nearestDist = dist
			end
		end
	end
	return nearest
end

--------------------------------------------------
-- AUTO MINE LOOP
--------------------------------------------------
local lastWebhookUpdate = tick()
local WEBHOOK_INTERVAL = 300 -- Send update every 5 minutes

RunService.Heartbeat:Connect(function()
	if not isEquipped or not autoMineEnabled or isMining then return end
	if not (character and humanoid and rootPart) then return end
	if humanoid.Health <= 0 then return end

	local block = findNearestBlock()
	if not block then
		statusLabel.Text = "Status: No block nearby"
		statusLabel.TextColor3 = COLOR_STATUS_WARN
		return
	else
		statusLabel.Text = "Status: Mining..."
		statusLabel.TextColor3 = COLOR_STATUS_ON
	end

	isMining = true

	if m1Track then m1Track:Play() end
	if minedTrack then minedTrack:Play() end

	mineCount = mineCount + 1

	if mineCount >= 8 then
		MineEvent:FireServer(block)
		mineCount = 0
		totalMined = totalMined + 1
		
		if dapetTrack then dapetTrack:Play() end
		
		-- Update GUI
		updateGui()
		
		-- Send periodic webhook updates
		if tick() - lastWebhookUpdate >= WEBHOOK_INTERVAL then
			sendWebhook(string.format("üìä Mining update: **%d blocks** mined", totalMined), 15844367) -- Gold
			lastWebhookUpdate = tick()
		end
		
		-- Send milestone webhooks
		if totalMined % 50 == 0 then
			sendWebhook(string.format("üéâ Milestone reached: **%d blocks** mined!", totalMined), 10181046) -- Purple
		end
	end

	task.wait(1)
	isMining = false
end)

-- Send initial webhook
sendWebhook("üöÄ Auto Mine script **LOADED**", 3447003)
print("‚úÖ Auto Mine loaded | Equip tool & press START")
print("üìç GUI positioned at center - Drag from title to move")
print("üåê Webhook configured:", SEND_WEBHOOK)
