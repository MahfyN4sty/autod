-- Roblox Auto E Hold Macro with UI (Fixed)
-- Paste this script into your executor and run

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")

-- Variables
local player = Players.LocalPlayer
local macroRunning = false

-- Function to hold key using mouse button simulation
local function holdKey(key, duration)
    if not macroRunning then return end
    
    local keyCode = Enum.KeyCode[key]
    
    -- Method 1: Direct key event
    game:GetService("VirtualInputManager"):SendKeyEvent(true, keyCode, false, game)
    
    -- Method 2: Backup using UserInputService
    local success = pcall(function()
        local inputObject = Instance.new("InputObject")
        inputObject.KeyCode = keyCode
        inputObject.UserInputType = Enum.UserInputType.Keyboard
    end)
    
    -- Hold for duration
    local startTime = tick()
    while macroRunning and (tick() - startTime) < duration do
        -- Keep the key pressed during hold
        task.wait(0.1)
        game:GetService("VirtualInputManager"):SendKeyEvent(true, keyCode, false, game)
    end
    
    -- Release the key
    if macroRunning then
        game:GetService("VirtualInputManager"):SendKeyEvent(false, keyCode, false, game)
    end
end

-- Alternative hold method using fireproximityprompt (for ProximityPrompt)
local function holdProximityPrompt(duration)
    if not macroRunning then return end
    
    local character = player.Character
    if not character then return end
    
    -- Find proximity prompt
    local prompt = character:FindFirstChildOfClass("ProximityPrompt", true) or
                   player.PlayerGui:FindFirstChildOfClass("ProximityPrompt", true)
    
    if prompt then
        print("Using ProximityPrompt method")
        fireproximityprompt(prompt, duration)
        wait(duration)
        return true
    end
    
    return false
end

-- Macro sequence function
local function runMacro()
    while macroRunning do
        print("Holding E for 3 seconds...")
        
        -- Try ProximityPrompt first (for gacha games)
        local usedPrompt = holdProximityPrompt(3)
        
        -- If no prompt found, use keyboard hold
        if not usedPrompt then
            holdKey("E", 3)
        end
        
        if not macroRunning then break end
        
        print("Waiting 2 seconds...")
        wait(2)
    end
end

-- Create UI
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local ToggleButton = Instance.new("TextButton")
local StatusLabel = Instance.new("TextLabel")
local InfoLabel = Instance.new("TextLabel")
local MethodLabel = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")

-- Properties
ScreenGui.Name = "GachaMacroUI"
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -140)
MainFrame.Size = UDim2.new(0, 300, 0, 280)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ZIndex = 10

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

Title.Name = "Title"
Title.Parent = MainFrame
Title.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Font = Enum.Font.GothamBold
Title.Text = "ðŸŽ® Gacha Auto Hold"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.ZIndex = 11

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = Title

InfoLabel.Name = "InfoLabel"
InfoLabel.Parent = MainFrame
InfoLabel.BackgroundTransparency = 1
InfoLabel.Position = UDim2.new(0, 0, 0.17, 0)
InfoLabel.Size = UDim2.new(1, 0, 0, 35)
InfoLabel.Font = Enum.Font.Gotham
InfoLabel.Text = "â±ï¸ Hold: 3s | Delay: 2s"
InfoLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
InfoLabel.TextSize = 13
InfoLabel.ZIndex = 11

MethodLabel.Name = "MethodLabel"
MethodLabel.Parent = MainFrame
MethodLabel.BackgroundTransparency = 1
MethodLabel.Position = UDim2.new(0, 0, 0.3, 0)
MethodLabel.Size = UDim2.new(1, 0, 0, 25)
MethodLabel.Font = Enum.Font.Gotham
MethodLabel.Text = "ðŸ“Œ Auto-detect method"
MethodLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
MethodLabel.TextSize = 11
MethodLabel.ZIndex = 11

ToggleButton.Name = "ToggleButton"
ToggleButton.Parent = MainFrame
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
ToggleButton.BorderSizePixel = 0
ToggleButton.Position = UDim2.new(0.1, 0, 0.47, 0)
ToggleButton.Size = UDim2.new(0.8, 0, 0, 50)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "START MACRO"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 16
ToggleButton.ZIndex = 11

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 8)
ButtonCorner.Parent = ToggleButton

StatusLabel.Name = "StatusLabel"
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0.75, 0)
StatusLabel.Size = UDim2.new(1, 0, 0, 30)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Status: Stopped â­•"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 14
StatusLabel.ZIndex = 11

CloseButton.Name = "CloseButton"
CloseButton.Parent = MainFrame
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(0.85, 0, 0.05, 0)
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16
CloseButton.ZIndex = 11

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 15)
CloseCorner.Parent = CloseButton

-- Toggle Button Function
ToggleButton.MouseButton1Click:Connect(function()
    macroRunning = not macroRunning
    
    if macroRunning then
        ToggleButton.Text = "STOP MACRO"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 220, 50)
        StatusLabel.Text = "Status: Running âœ…"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- Start macro in a new thread
        task.spawn(runMacro)
        
        print("===================================")
        print("Gacha Auto Hold Macro STARTED!")
        print("Hold E: 3 seconds | Delay: 2 seconds")
        print("===================================")
    else
        ToggleButton.Text = "START MACRO"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        StatusLabel.Text = "Status: Stopped â­•"
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        
        -- Release key
        game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.E, false, game)
        
        print("Gacha Auto Hold Macro STOPPED!")
    end
end)

-- Close Button Function
CloseButton.MouseButton1Click:Connect(function()
    macroRunning = false
    game:GetService("VirtualInputManager"):SendKeyEvent(false, Enum.KeyCode.E, false, game)
    ScreenGui:Destroy()
    print("Gacha Macro UI closed")
end)

-- Hover effects
ToggleButton.MouseEnter:Connect(function()
    ToggleButton.TextSize = 17
end)

ToggleButton.MouseLeave:Connect(function()
    ToggleButton.TextSize = 16
end)

CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
end)

CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
end)

print("===================================")
print("âœ… Gacha Auto Hold Macro Loaded!")
print("ðŸ“Œ Support ProximityPrompt & Keyboard")
print("â±ï¸ Hold: 3 seconds | Delay: 2 seconds")
print("ðŸŽ® Click START to begin")
print("===================================")
